{"version":3,"file":"ai_grading_integration.min.js","sources":["../src/ai_grading_integration.js"],"sourcesContent":["define(['jquery', 'core/ajax', 'core/notification'], function($, Ajax, Notification) {\n\n    /**\n     * Developed and maintained by Human Logic Software LLC.\n     */\n    function initAIGradingStatus() {\n        // Check if we're on an assignment grading page.\n        if (!$('body').hasClass('path-mod-assign')) {\n            return;\n        }\n\n        // Get assignment ID from URL or page data.\n        var urlParams = new URLSearchParams(window.location.search);\n        var cmid = urlParams.get('id');\n\n        if (!cmid) {\n            return;\n        }\n\n        // Find the grading table.\n        var $table = $('table.generaltable, table.flexible');\n        if ($table.length === 0) {\n            return;\n        }\n\n        // Add AI Status column header.\n        var $headerRow = $table.find('thead tr').first();\n        if ($headerRow.find('th.ai-status-header').length === 0) {\n            $headerRow.find('th:contains(\"Grade\")').after(\n                '<th class=\"ai-status-header\">AI Status</th>'\n            );\n        }\n\n        // Add AI status cells for each row.\n        var $rows = $table.find('tbody tr');\n        $rows.each(function() {\n            var $row = $(this);\n\n            // Skip if already processed.\n            if ($row.find('td.ai-status-cell').length > 0) {\n                return;\n            }\n\n            // Extract user ID from the row (various methods).\n            var userid = $row.data('userid') ||\n                        $row.find('[data-userid]').data('userid') ||\n                        extractUserIdFromRow($row);\n\n            if (!userid) {\n                return;\n            }\n\n            // Add placeholder cell.\n            var $gradeCell = $row.find('td').filter(function() {\n                return $(this).text().match(/\\d+\\/\\d+|-/);\n            }).first();\n\n            if ($gradeCell.length > 0) {\n                $gradeCell.after('<td class=\"ai-status-cell\" data-userid=\"' + userid + '\">...</td>');\n            }\n        });\n\n        // Load AI statuses via AJAX.\n        loadAIStatuses(cmid);\n    }\n\n    /**\n     * Developed and maintained by Human Logic Software LLC.\n     *\n     * @param {JQuery} $row\n     * @returns {number|null}\n     */\n    function extractUserIdFromRow($row) {\n        // Try to find user ID in links.\n        var $link = $row.find('a[href*=\"userid=\"]').first();\n        if ($link.length > 0) {\n            var match = $link.attr('href').match(/userid=(\\d+)/);\n            if (match) {\n                return match[1];\n            }\n        }\n\n        // Try data attributes.\n        var userid = $row.find('[data-userid]').first().data('userid');\n        if (userid) {\n            return userid;\n        }\n\n        return null;\n    }\n\n    /**\n     * Developed and maintained by Human Logic Software LLC.\n     *\n     * @param {number} cmid\n     */\n    function loadAIStatuses(cmid) {\n        var promises = Ajax.call([{\n            methodname: 'local_hlai_grading_get_ai_statuses',\n            args: {cmid: cmid}\n        }]);\n\n        promises[0].done(function(response) {\n            updateAIStatusCells(response);\n        }).fail(function(error) {\n            Notification.exception(error);\n        });\n    }\n\n    /**\n     * Developed and maintained by Human Logic Software LLC.\n     *\n     * @param {Object} statuses\n     */\n    function updateAIStatusCells(statuses) {\n        $.each(statuses, function(userid, status) {\n            var $cell = $('td.ai-status-cell[data-userid=\"' + userid + '\"]');\n            if ($cell.length > 0) {\n                $cell.html(renderAIStatusBadge(status));\n            }\n        });\n    }\n\n    /**\n     * Developed and maintained by Human Logic Software LLC.\n     *\n     * @param {Object} status\n     * @returns {string}\n     */\n    function renderAIStatusBadge(status) {\n        if (!status || !status.exists) {\n            return '<span class=\"badge badge-light\">-</span>';\n        }\n\n        var html = '';\n\n        switch (status.status) {\n            case 'draft':\n                html = '<span class=\"badge badge-warning\" title=\"AI Grade: ' + status.grade + '\">AI Draft</span> ';\n                html += '<a href=\"' + M.cfg.wwwroot + '/local/hlai_grading/release.php?id=' + status.resultid + '\" ';\n                html += 'class=\"btn btn-sm btn-primary\">Review</a>';\n                break;\n\n            case 'released':\n                html = '<span class=\"badge badge-success\" title=\"Released\">AI Released</span>';\n                break;\n\n            case 'rejected':\n                html = '<span class=\"badge badge-secondary\">AI Rejected</span>';\n                break;\n\n            case 'pending':\n                html = '<span class=\"badge badge-info\">AI Processing</span>';\n                break;\n\n            case 'failed':\n                html = '<span class=\"badge badge-danger\">AI Failed</span>';\n                break;\n        }\n\n        return html;\n    }\n    /**\n     * Developed and maintained by Human Logic Software LLC.\n     */\n    function init() {\n        if (document.readyState === 'loading') {\n            $(initAIGradingStatus);\n        } else {\n            initAIGradingStatus();\n        }\n    }\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","Ajax","Notification","initAIGradingStatus","hasClass","cmid","URLSearchParams","window","location","search","get","$table","length","$headerRow","find","first","after","each","$row","this","userid","data","$link","match","attr","extractUserIdFromRow","$gradeCell","filter","text","call","methodname","args","done","response","statuses","status","$cell","html","exists","grade","M","cfg","wwwroot","resultid","renderAIStatusBadge","fail","error","exception","loadAIStatuses","init","document","readyState"],"mappings":"AAAAA,mDAAO,CAAC,SAAU,YAAa,sBAAsB,SAASC,EAAGC,KAAMC,uBAK1DC,yBAEAH,EAAE,QAAQI,SAAS,wBAMpBC,KADY,IAAIC,gBAAgBC,OAAOC,SAASC,QAC/BC,IAAI,SAEpBL,UAKDM,OAASX,EAAE,yCACO,IAAlBW,OAAOC,YAKPC,WAAaF,OAAOG,KAAK,YAAYC,QACa,IAAlDF,WAAWC,KAAK,uBAAuBF,QACvCC,WAAWC,KAAK,wBAAwBE,MACpC,+CAKIL,OAAOG,KAAK,YAClBG,MAAK,eACHC,KAAOlB,EAAEmB,WAGTD,KAAKJ,KAAK,qBAAqBF,OAAS,QAKxCQ,OAASF,KAAKG,KAAK,WACXH,KAAKJ,KAAK,iBAAiBO,KAAK,oBA2BtBH,UAEtBI,MAAQJ,KAAKJ,KAAK,sBAAsBC,WACxCO,MAAMV,OAAS,EAAG,KACdW,MAAQD,MAAME,KAAK,QAAQD,MAAM,mBACjCA,aACOA,MAAM,OAKjBH,OAASF,KAAKJ,KAAK,iBAAiBC,QAAQM,KAAK,aACjDD,cACOA,cAGJ,KA1CSK,CAAqBP,SAE5BE,YAKDM,WAAaR,KAAKJ,KAAK,MAAMa,QAAO,kBAC7B3B,EAAEmB,MAAMS,OAAOL,MAAM,iBAC7BR,QAECW,WAAWd,OAAS,GACpBc,WAAWV,MAAM,2CAA6CI,OAAS,4BAsC3Df,MACLJ,KAAK4B,KAAK,CAAC,CACtBC,WAAY,qCACZC,KAAM,CAAC1B,KAAMA,SAGR,GAAG2B,MAAK,SAASC,cAYDC,SAAAA,SAXDD,SAYxBjC,EAAEiB,KAAKiB,UAAU,SAASd,OAAQe,YAC1BC,MAAQpC,EAAE,kCAAoCoB,OAAS,MACvDgB,MAAMxB,OAAS,GACfwB,MAAMC,cAWWF,YACpBA,SAAWA,OAAOG,aACZ,+CAGPD,KAAO,UAEHF,OAAOA,YACN,QACDE,KAAO,sDAAwDF,OAAOI,MAAQ,qBAC9EF,MAAQ,YAAcG,EAAEC,IAAIC,QAAU,sCAAwCP,OAAOQ,SAAW,KAChGN,MAAQ,sDAGP,WACDA,KAAO,kFAGN,WACDA,KAAO,mEAGN,UACDA,KAAO,gEAGN,SACDA,KAAO,2DAIRA,KA1CYO,CAAoBT,eAdpCU,MAAK,SAASC,OACb5C,aAAa6C,UAAUD,UA1C3BE,CAAe3C,eA8GZ,CACH4C,gBAR4B,YAAxBC,SAASC,WACTnD,EAAEG,qBAEFA"}